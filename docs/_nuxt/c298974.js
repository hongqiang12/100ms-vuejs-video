(window.webpackJsonp=window.webpackJsonp||[]).push([[18,20],{441:function(e,t,r){"use strict";r.r(t),r.d(t,"resetPIPCanvasColors",(function(){return h})),r.d(t,"drawVideoElementsOnCanvas",(function(){return d})),r.d(t,"dummyChangeInCanvas",(function(){return l}));var n,o;r(52),r(20),r(72),r(40);function c(){n||(n=window.getComputedStyle(document.documentElement).getPropertyValue("--hms-ui-colors-surface_bright")),o||(o=window.getComputedStyle(document.documentElement).getPropertyValue("--hms-ui-colors-border_bright"))}function h(){n="",o=""}function d(e,canvas){var t=e.filter((function(e){return null!==e.srcObject})),r=canvas.getContext("2d");c(),r.fillStyle=n,r.clearRect(0,0,canvas.width,canvas.height),0!==t.length?function(e,t,canvas){var r=8;canvas.width=480,canvas.height=320,t.fillStyle=n,t.fillRect(0,0,canvas.width,canvas.height),e.length>0&&(t.strokeStyle=o,t.lineWidth=r/2,t.strokeRect(0,0,canvas.width,canvas.height));if(1===e.length){var video=e[0],c=m(video,canvas.width-r,canvas.height-r),h=c.width,d=c.height,l=(canvas.width-h)/2,f=(canvas.height-d)/2;t.drawImage(video,l,f,h,d)}if(2===e.length){e.forEach((function(video,e){var n=m(video,canvas.width/2-r,canvas.height-r),o=n.width,c=n.height,h=(canvas.width/2-o)/2+canvas.width/2*e,d=(canvas.height-c)/2;t.drawImage(video,h,d,o,c)}));var path=new Path2D;path.moveTo(canvas.width/2,0),path.lineTo(canvas.width/2,canvas.height),t.stroke(path)}if(3===e.length){e.forEach((function(video,e){var n=m(video,canvas.width/2-r,canvas.height/2-r),o=n.width,c=n.height,h=e<2?(canvas.width/2-o)/2+canvas.width/2*e:canvas.width/2-o/2,d=(e<2?0:canvas.height/2)+(canvas.height/2-c)/2;t.drawImage(video,h,d,o,c)}));var v=new Path2D;v.moveTo(canvas.width/2,0),v.lineTo(canvas.width/2,canvas.height/2),t.stroke(v),v.moveTo(0,canvas.height/2),v.lineTo(canvas.width,canvas.height/2),t.stroke(v)}if(4===e.length){e.forEach((function(video,e){var n=m(video,canvas.width/2-r,canvas.height/2-r),o=n.width,c=n.height,h=(canvas.width/2-o)/2+canvas.width/2*(e%2),d=(e<2?0:canvas.height/2)+(canvas.height/2-c)/2;t.drawImage(video,h,d,o,c)}));var w=new Path2D;w.moveTo(canvas.width/2,0),w.lineTo(canvas.width/2,canvas.height),t.stroke(w),w.moveTo(0,canvas.height/2),w.lineTo(canvas.width,canvas.height/2),t.stroke(w)}}(t.slice(0,4),r,canvas):r.fillRect(0,0,canvas.width,canvas.height)}function l(canvas){var e=canvas.getContext("2d");c(),e.fillStyle=n,e.fillRect(0,0,canvas.width,canvas.height)}function m(video,e,t){var r=video.videoWidth/video.videoHeight*t,n=t;return r>e&&(r=e,n=video.videoHeight/video.videoWidth*e),{width:r,height:n}}},447:function(e,t,r){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,c=2*o,h=function(e,t){return function(r){var h=t.get(r),d=void 0===h?r.size:h<c?h+1:0;if(!r.has(d))return e(r,d);if(r.size<o){for(;r.has(d);)d=Math.floor(Math.random()*c);return e(r,d)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(d);)d=Math.floor(Math.random()*n);return e(r,d)}},d=new WeakMap,l=r(d),m=h(l,d),f=t(m);e.addUniqueNumber=f,e.generateUniqueNumber=m}(t)},464:function(e,t,r){"use strict";r.r(t),r.d(t,"PictureInPicture",(function(){return V}));r(72),r(54),r(51),r(73),r(42),r(28),r(41),r(74),r(75),r(43);var n=r(10),o=r(182),c=r(183),h=(r(20),r(40),r(71),r(447));const d=((e,t)=>{let r=null;return()=>{if(null!==r)return r;const n=new Blob([t],{type:"application/javascript; charset=utf-8"}),o=URL.createObjectURL(n);return r=e(o),setTimeout((()=>URL.revokeObjectURL(o))),r}})((e=>{const t=new Map([[0,()=>{}]]),r=new Map([[0,()=>{}]]),n=new Map,o=new Worker(e);o.addEventListener("message",(({data:data})=>{if(void 0!==(e=data).method&&"call"===e.method){const{params:{timerId:e,timerType:o}}=data;if("interval"===o){const r=t.get(e);if("number"==typeof r){const t=n.get(r);if(void 0===t||t.timerId!==e||t.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===r)throw new Error("The timer is in an undefined state.");r()}}else if("timeout"===o){const t=r.get(e);if("number"==typeof t){const r=n.get(t);if(void 0===r||r.timerId!==e||r.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===t)throw new Error("The timer is in an undefined state.");t(),r.delete(e)}}}else{if(!(e=>null===e.error&&"number"==typeof e.id)(data)){const{error:{message:e}}=data;throw new Error(e)}{const{id:e}=data,o=n.get(e);if(void 0===o)throw new Error("The timer is in an undefined state.");const{timerId:c,timerType:h}=o;n.delete(e),"interval"===h?t.delete(c):r.delete(c)}}var e}));return{clearInterval:e=>{const r=Object(h.generateUniqueNumber)(n);n.set(r,{timerId:e,timerType:"interval"}),t.set(e,r),o.postMessage({id:r,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:e=>{const t=Object(h.generateUniqueNumber)(n);n.set(t,{timerId:e,timerType:"timeout"}),r.set(e,t),o.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:(e,r)=>{const n=Object(h.generateUniqueNumber)(t);return t.set(n,(()=>{e(),"function"==typeof t.get(n)&&o.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:n,timerType:"interval"}})})),o.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:n,timerType:"interval"}}),n},setTimeout:(e,t)=>{const n=Object(h.generateUniqueNumber)(r);return r.set(n,e),o.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:n,timerType:"timeout"}}),n}}}),'(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();');var l,m,f,v,w,y,k=r(441),T=r(405),E=(null===(l=T.n.getBrowser())||void 0===l||null===(l=l.name)||void 0===l||l.toLowerCase(),null===(m=T.n.getBrowser())||void 0===m||null===(m=m.name)||void 0===m||m.toLowerCase(),"safari"===(null===(f=T.n.getBrowser())||void 0===f||null===(f=f.name)||void 0===f?void 0:f.toLowerCase())),x="ios"===(null===(v=T.n.getOS())||void 0===v||null===(v=v.name)||void 0===v?void 0:v.toLowerCase()),I="mac os"===(null===(w=T.n.getOS())||void 0===w||null===(w=w.name)||void 0===w?void 0:w.toLowerCase());null===(y=T.n.getOS())||void 0===y||null===(y=y.name)||void 0===y||y.toLowerCase();function O(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,h=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){h=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(h)throw o}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var S="leavepictureinpicture",R="starting",C="started",M="stopping",j="stopped",A=function(){function e(){var t=this;Object(o.a)(this,e),this.stop=Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state!==j){e.next=2;break}return e.abrupt("return");case 2:return t.state=M,null===(r=t.pipVideo)||void 0===r||r.removeEventListener(S,t.stop),t.timeoutRef&&(n=t.timeoutRef,d().clearTimeout(n)),t.isOn()&&t.exitPIP(),e.next=8,t.detachOldAttachNewTracks(t.tracksToShow,[]);case 8:t.onStateChange(!1),t.reset(),t.state=j;case 11:case"end":return e.stop()}var n}),e)}))),this.reset()}var t,r,h,l,m,f;return Object(c.a)(e,[{key:"reset",value:function(){console.debug("resetting PIP state"),Object(k.resetPIPCanvasColors)(),this.canvas=null,this.pipVideo=null,this.timeoutRef=null,this.hmsActions=null,this.videoElements=[],this.tracksToShow=[],this.onStateChange=function(){},this.state=j}},{key:"isSupported",value:function(){return!(!document.pictureInPictureEnabled||x||I&&E)}},{key:"isOn",value:function(){return!!document.pictureInPictureElement}},{key:"start",value:(f=Object(n.a)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isSupported()){e.next=2;break}throw new Error("pip is not supported on this browser");case 2:if(console.debug("starting PIP, current state",this.state),this.state!==C){e.next=8;break}return e.next=6,this.stop();case 6:e.next=10;break;case 8:if(this.state!==R){e.next=10;break}return e.abrupt("return");case 10:return this.state=R,e.prev=11,e.next=14,this.init(t,r);case 14:if(this.pipVideo.addEventListener(S,this.stop),this.renderLoop(),this.isOn()){e.next=19;break}return e.next=19,this.requestPIP();case 19:console.debug("pip started"),this.state=C,this.onStateChange(!0),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(11),console.error("error in request pip",e.t0),this.state=j;case 28:case"end":return e.stop()}}),e,this,[[11,24]])}))),function(e,t){return f.apply(this,arguments)})},{key:"updatePeersAndTracks",value:(m=Object(n.a)(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas){e.next=2;break}return e.abrupt("return");case 2:return n=this.pickTracksToShow(t,r),o=this.tracksToShow,this.tracksToShow=this.orderNewTracksToShow(n,o),e.prev=5,e.next=8,this.detachOldAttachNewTracks(o,this.tracksToShow,r);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("error in detaching/attaching tracks",e.t0);case 13:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(e,t){return m.apply(this,arguments)})},{key:"init",value:(l=Object(n.a)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initMediaElements();case 2:this.hmsActions=t,this.onStateChange=r;case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"initMediaElements",value:(h=Object(n.a)(regeneratorRuntime.mark((function e(){var t,canvas,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas){e.next=9;break}return t=this.initializeCanvasAndVideoElement(),canvas=t.canvas,r=t.pipVideo,this.canvas=canvas,this.pipVideo=r,this.videoElements=this.initializeVideoElements(),n=this.pipVideo.play(),Object(k.dummyChangeInCanvas)(this.canvas),e.next=9,n;case 9:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"initializeCanvasAndVideoElement",value:function(){var canvas=document.createElement("canvas");canvas.width=480,canvas.height=320;var e=document.createElement("video");return e.width=480,e.height=320,e.muted=!0,e.srcObject=canvas.captureStream(),{canvas:canvas,pipVideo:e}}},{key:"initializeVideoElements",value:function(){for(var e=[],i=0;i<4;i++){var t=document.createElement("video");t.autoplay=!0,t.playsinline=!0,e.push(t)}return e}},{key:"renderLoop",value:function(){var e=this;this.timeoutRef=((e,t)=>d().setTimeout(e,t))((function(){e.state!==M&&e.state!==j&&(e.state===C&&Object(k.drawVideoElementsOnCanvas)(e.videoElements,e.canvas),e.renderLoop())}),33.333333333333336)}},{key:"requestPIP",value:(r=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.isOn()&&this.exitPIP(),e.next=4,this.pipVideo.requestPictureInPicture();case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.error("error in requestpip",e.t0,"state",this.state),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return r.apply(this,arguments)})},{key:"exitPIP",value:function(){document.exitPictureInPicture()}},{key:"pickTracksToShow",value:function(e,t){var r,n=[],o=O(e);try{for(o.s();!(r=o.n()).done;){var c,h=r.value;if(4===n.length)break;h.videoTrack&&null!==(c=t[h.videoTrack])&&void 0!==c&&c.enabled&&n.push(h.videoTrack)}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"orderNewTracksToShow",value:function(e,t){var r=[],n=[];e.forEach((function(track){var o=t.indexOf(track);-1!==o&&o<e.length?r[o]=track:n.push(track)}));for(var i=0;i<e.length;i++)r[i]||(r[i]=n.shift());return r}},{key:"detachOldAttachNewTracks",value:(t=Object(n.a)(regeneratorRuntime.mark((function e(t,r){var n,o,i,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=c.length>2&&void 0!==c[2]?c[2]:null,o=Math.max(t.length,r.length),i=0;case 3:if(!(i<o)){e.next=19;break}if(t[i]!==r[i]){e.next=8;break}return e.abrupt("continue",16);case 8:if(!t[i]){e.next=13;break}if(n&&!n[t[i]]){e.next=12;break}return e.next=12,this.hmsActions.detachVideo(t[i],this.videoElements[i]);case 12:this.videoElements[i]&&(this.videoElements[i].srcObject=null);case 13:if(!r[i]){e.next=16;break}return e.next=16,this.hmsActions.attachVideo(r[i],this.videoElements[i]);case 16:i++,e.next=3;break;case 19:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),V=new A}}]);